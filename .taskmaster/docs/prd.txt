# ğŸ“„ PRD (Product Requirements Document)

**í”„ë¡œì íŠ¸ëª…:** ì‹¤ì‹œê°„ WebSocket ê¸°ë°˜ ì±—ë´‡ ì‹œìŠ¤í…œ êµ¬ì¶•

------------------------------------------------------------------------

## 1. ê°œìš”

-   **ëª©ì :**\
    ì‹¤ì‹œê°„ ì†Œì¼“ í†µì‹  ê¸°ë°˜ ì±—ë´‡ì„ êµ¬ì¶•í•˜ì—¬ ì‚¬ìš©ìì™€ AIê°€ ì§€ì—° ì—†ì´ ëŒ€í™”í• 
    ìˆ˜ ìˆëŠ” í™˜ê²½ ì œê³µ.\
-   **ì£¼ìš” íŠ¹ì§•:**
    -   WebSocket(Socket.IO) ê¸°ë°˜ ì–‘ë°©í–¥ í†µì‹ \
    -   ë©€í‹°ë£¸(ì±„íŒ…ë°©) ì§€ì›\
    -   ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ(LLM í† í° ë‹¨ìœ„ ì‹¤ì‹œê°„ ì „ì†¡)\
    -   ëŒ€í™” ì €ì¥ ë° ê²€ìƒ‰\
    -   ìˆ˜í‰ í™•ì¥ì„ ê³ ë ¤í•œ ì•„í‚¤í…ì²˜ (Redis adapter, ë¬´ìƒíƒœ ê²Œì´íŠ¸ì›¨ì´)

------------------------------------------------------------------------

## 2. ëª©í‘œ

1.  ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í›„ ì‹¤ì‹œê°„ ì±—ë´‡ê³¼ ëŒ€í™” ê°€ëŠ¥\
2.  ì±—ë´‡ ì‘ë‹µì€ **ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹**ìœ¼ë¡œ ì‹¤ì‹œê°„ ì „ì†¡\
3.  ëŒ€í™” ë°ì´í„°ëŠ” **Postgres**ì— ì €ì¥, ë²¡í„° ê²€ìƒ‰ì„ í†µí•´ ë§¥ë½ ìœ ì§€\
4.  **ë©€í‹° ë””ë°”ì´ìŠ¤ ë™ì‹œ ì ‘ì†** ì‹œ ë©”ì‹œì§€ ë™ê¸°í™” ì§€ì›\
5.  ì•ˆì •ì ì¸ í™•ì¥ì„ ìœ„í•´ **Redis ê¸°ë°˜ ì†Œì¼“ ì–´ëŒ‘í„°** ì ìš©

------------------------------------------------------------------------

## 3. ì£¼ìš” ê¸°ëŠ¥

### 3.1 ì‚¬ìš©ì ì¸ì¦/ê¶Œí•œ

-   JWT ê¸°ë°˜ ì¸ì¦ (NextAuth.js + NestJS JWT ê²€ì¦)
-   ì†Œì¼“ í•¸ë“œì…°ì´í¬ ì‹œ í† í° í™•ì¸ â†’ ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì—°ê²° ê±°ë¶€

### 3.2 ì±„íŒ… ê¸°ëŠ¥

-   ë©”ì‹œì§€ ì „ì†¡ (í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„)
-   ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸ (ì„œë²„ â†’ ë£¸)
-   ë©€í‹°ë£¸ ì§€ì› (`join`, `leave` ì´ë²¤íŠ¸)
-   ë©”ì‹œì§€ ì˜êµ¬ ì €ì¥ (Prisma + Postgres)

### 3.3 ì±—ë´‡ ê¸°ëŠ¥

-   LLM API(OpenAI/Anthropic ë“±) ì—°ë™
-   ì‚¬ìš©ì ë°œí™” ì…ë ¥ â†’ ë°±ì—”ë“œì—ì„œ íì‰ í›„ LLM í˜¸ì¶œ
-   ì‘ë‹µì€ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬
-   ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ (ìµœê·¼ Nê°œ ë©”ì‹œì§€ + ë²¡í„° ê²€ìƒ‰ ê¸°ë°˜ RAG)

### 3.4 ê´€ë¦¬ì ê¸°ëŠ¥(ì„ íƒ)

-   ëŒ€í™” ë¡œê·¸ ëª¨ë‹ˆí„°ë§
-   ìœ ì €ë³„/ë°©ë³„ ë©”ì‹œì§€ í†µê³„
-   ì—ëŸ¬ ë¡œê¹…/í† í° ì‚¬ìš©ëŸ‰ ì¶”ì 

------------------------------------------------------------------------

## 4. ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ

-   **Next.js 14(App Router, TS)**
-   Zustand (ìƒíƒœ ê´€ë¦¬), React Query (ë°ì´í„° ìºì‹±)
-   socket.io-client
-   SCSS (ìŠ¤íƒ€ì¼ë§)

### ë°±ì—”ë“œ

-   **NestJS (Gateway, API ëª¨ë“ˆ ë¶„ë¦¬)**
-   Socket.IO Gateway
-   REST API (ìœ ì € ê´€ë¦¬, ëŒ€í™” ì¡°íšŒ)
-   Prisma ORM + PostgreSQL
-   Redis (ì„¸ì…˜ ê³µìœ  + Socket adapter)

### ì¸í”„ë¼

-   Docker Compose (ê°œë°œ)
-   Nginx + Docker/K8s (ìš´ì˜)
-   Redis Cluster (í™•ì¥ì„±)
-   Postgres + pgvector (ëŒ€í™” ê²€ìƒ‰)

------------------------------------------------------------------------

## 5. ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

     [Next.js] -- socket.io --> [NestJS Gateway] -- Redis Adapter -- [ë‹¤ë¥¸ Gateway ì¸ìŠ¤í„´ìŠ¤]
          |                                   |
          | REST API                          | Prisma ORM
          v                                   v
     [User/Chat UI] <-----> [NestJS API] <--> [PostgreSQL + pgvector]
                                   |
                                   v
                                [LLM API]

------------------------------------------------------------------------

## 6. ë°ì´í„° ëª¨ë¸ (ì´ˆì•ˆ)

### User

-   id (UUID)
-   email
-   name
-   createdAt

### Room

-   id (UUID)
-   name
-   createdAt

### Message

-   id (UUID)
-   roomId (FK)
-   userId (FK, optional for bot)
-   role ("user" \| "bot")
-   content (text)
-   createdAt

------------------------------------------------------------------------

## 7. API/ì†Œì¼“ ì´ë²¤íŠ¸ ì„¤ê³„

### REST API

-   `POST /auth/login` â†’ JWT ë°œê¸‰
-   `GET /rooms/:id/messages` â†’ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
-   `POST /rooms` â†’ ìƒˆë¡œìš´ ì±„íŒ…ë°© ìƒì„±

### ì†Œì¼“ ì´ë²¤íŠ¸

-   `join { roomId }`
-   `leave { roomId }`
-   `send { roomId, text }`
-   `message { userId, text, ts }`
-   `stream { token }` (LLM ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ)

------------------------------------------------------------------------

## 8. ìš´ì˜ ê³ ë ¤ì‚¬í•­

-   **ìˆ˜í‰ í™•ì¥:** Socket.IO + Redis adapter ì ìš©
-   **ë³´ì•ˆ:** JWT ì¸ì¦, ë©”ì‹œì§€ ê¸¸ì´/ë¹ˆë„ ì œí•œ, Rate limiting
-   **ë¡œê·¸/ëª¨ë‹ˆí„°ë§:** OpenTelemetry + Prometheus + Grafana
-   **í…ŒìŠ¤íŠ¸:** Vitest(ë‹¨ìœ„), Playwright(E2E)

------------------------------------------------------------------------

## 9. ì¼ì • (ì˜ˆì‹œ, 6ì£¼ í”Œëœ)

1.  ì£¼ì°¨ 1: í™˜ê²½ ì„¸íŒ…(ëª¨ë…¸ë ˆí¬, Next.js/NestJS, DB, Redis)
2.  ì£¼ì°¨ 2: ì¸ì¦ + ê¸°ë³¸ ì±„íŒ… ê¸°ëŠ¥
3.  ì£¼ì°¨ 3: ì±—ë´‡ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ(LLM ì—°ë™)
4.  ì£¼ì°¨ 4: ëŒ€í™” ì €ì¥/ì¡°íšŒ, ë²¡í„° ê²€ìƒ‰
5.  ì£¼ì°¨ 5: ê´€ë¦¬ì ê¸°ëŠ¥ + ëª¨ë‹ˆí„°ë§
6.  ì£¼ì°¨ 6: ë¶€í•˜í…ŒìŠ¤íŠ¸, ë°°í¬(K8s/Docker)

------------------------------------------------------------------------

## 10. ì„±ê³µ ì§€í‘œ (KPI)

-   í‰ê·  ì‘ë‹µ ì§€ì—°(latency) \< **300ms**
-   1,000 ë™ì‹œ ì—°ê²° ì‹œ ì•ˆì • ë™ì‘
-   ë©”ì‹œì§€ ì†ì‹¤ë¥  0%
-   í‰ê·  ì„œë²„ ê°€ë™ë¥  99.9%
